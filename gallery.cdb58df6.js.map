{"version":3,"sources":["gallery/index.js"],"names":["output","document","getElementById","count","size","spacing","width","render","callback","time","context","index","fillStyle","fillRect","y","x","value","Number","offset","color","radius","beginPath","arc","Math","PI","fill","fetch","s","then","response","text","split","filter","line","indexOf","forEach","code","link","createElement","canvas","getContext","url","URL","location","searchParams","set","appendChild","classList","add","setAttribute","height","pausesStart","Function","pausedDuration","startTime","active","loop","setTimeout","Date","ticking","inView","rect","getBoundingClientRect","window","innerHeight","documentElement","clientHeight","top","bottom","start","duration","remove","addEventListener","e","requestAnimationFrame"],"mappings":";;;AA6CA,aA7CA,IAAA,EAAA,EAAA,QAAA,mBA6CA,SAAA,EAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,GA3CA,IAAMA,EAASC,SAASC,eAAe,UACjCC,EAAQ,GACRC,EAAO,GACPC,EAAU,EACVC,EAAQH,GAASC,EAAOC,GAAWA,EAEzC,SAASE,EAAOC,EAAUC,EAAMC,GAC1BC,IAAAA,EAAQ,EAEZD,EAAQE,UAAY,OACpBF,EAAQG,SAAS,EAAG,EAAGP,EAAOA,GAEzB,IAAA,IAAIQ,EAAI,EAAGA,EAAIX,EAAOW,IACpB,IAAA,IAAIC,EAAI,EAAGA,EAAIZ,EAAOY,IAAK,CACxBC,IAAAA,EAAQC,OAAOT,EAASC,EAAME,EAAOI,EAAGD,IACxCI,EAASd,EAAO,EAClBe,EAAQ,OACRC,EAAUJ,EAAQZ,EAAQ,EAE1BgB,EAAS,IACXA,GAAUA,EACVD,EAAQ,QAGNC,EAAShB,EAAO,IAClBgB,EAAShB,EAAO,GAGlBM,EAAQW,YACRX,EAAQE,UAAYO,EACpBT,EAAQY,IACNP,GAAKX,EAAOC,GAAWa,EACvBJ,GAAKV,EAAOC,GAAWa,EACvBE,EACA,EACA,EAAIG,KAAKC,IAEXd,EAAQe,OACRd,KAKNe,MAAMC,EAAD,SACFC,KAAK,SAAAC,GAAYA,OAAAA,EAASC,SAC1BF,KAAK,SAAAE,GAEUA,EAAKC,MAAM,MACtBC,OAAO,SAAAC,GAAQA,MAAS,KAATA,IACfD,OAAO,SAAAC,GAAQA,OAAAA,EAAKC,QAAQ,QAEzBC,QAAQ,SAAAC,GACNC,IAAAA,EAAOpC,SAASqC,cAAc,KAC9BC,EAAStC,SAASqC,cAAc,UAChC5B,EAAU6B,EAAOC,WAAW,MAE5BC,EAAM,IAAIC,IAAI,IAAKzC,SAAS0C,UAClCF,EAAIG,aAAaC,IAAI,OAAQT,GAE7BC,EAAKS,YAAYP,GACjBF,EAAKU,UAAUC,IAAI,UACnBX,EAAKY,aAAa,OAAQR,GAG1BzC,EAAO8C,YAAYT,GACnBE,EAAOjC,MAAQA,EACfiC,EAAOW,OAAS5C,EAEVE,IAUFC,EACA0C,EAXE3C,EAAY,IAAI4C,SAAS,IAAK,IAAK,IAAK,IAEjChB,6CAAAA,OAAAA,EAFb,yBAQA7B,EAAOC,EAFa,EAEUE,GAK1B2C,IACAC,EADAD,EAAiB,EAEjBE,GAAS,GAEJC,SAAAA,IACPC,WAAWD,EAAM,IAEZD,IAIAD,EAIH7C,GAAQ,IAAIiD,KAASJ,EAAYD,GAAkB,KAHnDC,EAAYrC,OAAO,IAAIyC,MACvBjD,EAAO,GAKTF,EAAOC,EAAUC,EAAMC,IAGzB8C,GAkCIG,IAAAA,GAAU,EAELC,SAAAA,IACDC,IAAAA,EAAOxB,EAAKyB,wBACZZ,EAASa,OAAOC,aAAe/D,SAASgE,gBAAgBC,aAC1DL,EAAKM,KAAO,GAAKN,EAAKO,QAAUlB,EArC7BmB,WAEHd,IAAAA,EAAAA,CAIAJ,GAAAA,EAAa,CACTmB,IAAAA,EAAW,IAAIZ,KAASP,EAC9BE,GAAkBiB,EAGpBf,GAAS,EACThB,EAAOQ,UAAUC,IAAI,WA0BnBqB,GArBGd,IAILA,GAAS,EAETJ,EAAc,IAAIO,KAElBnB,EAAOQ,UAAUwB,OAAO,WAmB1BtE,SAASuE,iBAAiB,SAAU,SAASC,GACtCd,IACHI,OAAOW,sBAAsB,WAC3Bd,IACAD,GAAU,IAGZA,GAAU,KAIdC","file":"gallery.cdb58df6.js","sourceRoot":"../src","sourcesContent":["import s from './snippets.txt';\n\nconst output = document.getElementById('output');\nconst count = 16;\nconst size = 16;\nconst spacing = 1;\nconst width = count * (size + spacing) - spacing;\n\nfunction render(callback, time, context){\n  let index = 0;\n\n  context.fillStyle = '#000';\n  context.fillRect(0, 0, width, width);\n\n  for (let y = 0; y < count; y++) {\n    for (let x = 0; x < count; x++) {\n      const value = Number(callback(time, index, x, y));\n      const offset = size / 2;\n      let color = '#FFF';\n      let radius = (value * size) / 2;\n\n      if (radius < 0) {\n        radius = -radius;\n        color = '#F24';\n      }\n\n      if (radius > size / 2) {\n        radius = size / 2;\n      }\n\n      context.beginPath();\n      context.fillStyle = color;\n      context.arc(\n        x * (size + spacing) + offset,\n        y * (size + spacing) + offset,\n        radius,\n        0,\n        2 * Math.PI\n      );\n      context.fill();\n      index++;\n    }\n  }\n}\n\nfetch(s)\n  .then(response => response.text())\n  .then(text => {\n\n    const lines = text.split('\\n')\n      .filter(line => line !== '')\n      .filter(line => line.indexOf('//'));\n\n    lines.forEach(code => {\n      const link = document.createElement('a');\n      const canvas = document.createElement('canvas');\n      const context = canvas.getContext('2d');\n\n      const url = new URL('/', document.location);\n      url.searchParams.set('code', code);\n\n      link.appendChild(canvas);\n      link.classList.add('canvas');\n      link.setAttribute('href', url);\n\n\n      output.appendChild(link);\n      canvas.width = width;\n      canvas.height = width;\n\n      const callback  = new Function('t', 'i', 'x', 'y', `\n        with (Math) {\n          return ${code};\n        }\n      `);\n\n      const defaultTime = 0;\n\n      render(callback, defaultTime, context);\n\n      let time;\n      let pausesStart;\n      let pausesEnd;\n      let pausedDuration = 0;\n      let startTime;\n      let active = false;\n\n      function loop() {\n        setTimeout(loop, 10);\n\n        if (!active) {\n          return;\n        }\n\n        if (!startTime) {\n          startTime = Number(new Date());\n          time = 0;\n        } else {\n          time = (new Date() - startTime - pausedDuration) / 1000;\n        }\n\n        render(callback, time, context);\n      }\n\n      loop();\n\n      function start(){\n\n        if (active)Â {\n          return;\n        }\n\n        if (pausesStart) {\n          const duration = new Date() - pausesStart;\n          pausedDuration += duration;\n        }\n\n        active = true;\n        canvas.classList.add('active');\n      }\n\n      function stop(){\n\n        if (!active){\n          return;\n        }\n\n        active = false;\n        // startTime = null;\n        pausesStart = new Date();\n        // render(callback, defaultTime, context);\n        canvas.classList.remove('active');\n      }\n\n\n      // canvas.addEventListener('mouseover', start);\n      // canvas.addEventListener('mouseout', stop);\n\n      let ticking = false;\n\n      function inView(){\n        const rect = link.getBoundingClientRect();\n        const height = window.innerHeight || document.documentElement.clientHeight;\n        if (rect.top >= 0 && rect.bottom <= height) {\n          start();\n        } else {\n          stop();\n        }\n      }\n\n      document.addEventListener('scroll', function(e) {\n        if (!ticking) {\n          window.requestAnimationFrame(function() {\n            inView();\n            ticking = false;\n          });\n\n          ticking = true;\n        }\n      });\n\n      inView();\n\n    });\n  });\n\n"]}