{"version":3,"sources":["webpack:///src/browser.coffee","webpack:///webpack/universalModuleDefinition","webpack:///gif.js","webpack:///webpack/bootstrap c4508600e32c0e7f0139","webpack:///src/gif.coffee","webpack:///~/events/events.js","gif/index.js"],"names":["browser","root","factory","module","exports","amd","define","this","modules","moduleId","installedModules","id","loaded","call","__webpack_require__","m","c","p","GIF","hasProp","hasOwnProperty","indexOf","item","l","length","i","EventEmitter","superClass","options","key","value","running","frames","groups","freeWorkers","activeWorkers","setOptions","defaults","base","frameDefaults","extend","child","parent","constructor","prototype","__super__","workerScript","workers","repeat","background","quality","width","height","transparent","debug","delay","copy","setOption","_canvas","results","push","addFrame","image","index","frame","ImageData","data","CanvasRenderingContext2D","WebGLRenderingContext","getContextData","context","childNodes","Error","getImageData","has","get","set","render","j","numWorkers","ref","nextFrame","finishedFrames","imageParts","spawnWorkers","globalPalette","renderNextFrame","emit","abort","worker","shift","log","terminate","Math","min","apply","forEach","_this","onmessage","event","splice","frameFinished","duplicate","indexOfDuplicate","indexOfFirstInGroup","finishRendering","k","len","len1","len2","len3","len4","offset","page","ref1","ref2","ref3","pageSize","cursor","round","type","task","getTask","postMessage","ctx","document","createElement","getContext","setFill","fillRect","drawImage","last","dither","canTransfer","msg","_events","_maxListeners","undefined","arg","defaultMaxListeners","setMaxListeners","n","isNumber","isNaN","handler","args","listeners","error","isObject","er","arguments","err","isUndefined","isFunction","Array","slice","addListener","listener","newListener","warned","console","trace","on","once","removeListener","g","fired","position","list","removeAllListeners","ret","listenerCount","evlistener","emitter","mode","platform","ua","navigator","userAgent","toLowerCase","UA","match","documentMode","name","version","parseFloat","parseInt","scale","count","size","spacing","padding","getElementById","src","$output","$editor","$input","$duration","url","URL","location","run","gif","code","duration","searchParams","history","replaceState","callback","Function","time","fillStyle","y","x","Number","color","radius","beginPath","arc","PI","fill","Date","blob","link","download","href","createObjectURL","click","ratio","innerText","addEventListener","preventDefault","setTimeout"],"mappings":"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","file":"gif.f743ba06.js","sourceRoot":"../src","sourcesContent":["### CoffeeScript version of the browser detection from MooTools ###\r\n\r\nua = navigator.userAgent.toLowerCase()\r\nplatform = navigator.platform.toLowerCase()\r\nUA = ua.match(/(opera|ie|firefox|chrome|version)[\\s\\/:]([\\w\\d\\.]+)?.*?(safari|version[\\s\\/:]([\\w\\d\\.]+)|$)/) or [null, 'unknown', 0]\r\nmode = UA[1] == 'ie' && document.documentMode\r\n\r\nbrowser =\r\n  name: if UA[1] is 'version' then UA[3] else UA[1]\r\n  version: mode or parseFloat(if UA[1] is 'opera' && UA[4] then UA[4] else UA[2])\r\n\r\n  platform:\r\n    name: if ua.match(/ip(?:ad|od|hone)/) then 'ios' else (ua.match(/(?:webos|android)/) or platform.match(/mac|win|linux/) or ['other'])[0]\r\n\r\nbrowser[browser.name] = true\r\nbrowser[browser.name + parseInt(browser.version, 10)] = true\r\nbrowser.platform[browser.platform.name] = true\r\n\r\nmodule.exports = browser\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/browser.coffee\n **/","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"GIF\"] = factory();\n\telse\n\t\troot[\"GIF\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"GIF\"] = factory();\n\telse\n\t\troot[\"GIF\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar EventEmitter, GIF, browser,\n\t  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n\t  hasProp = {}.hasOwnProperty,\n\t  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\t\n\tEventEmitter = __webpack_require__(1).EventEmitter;\n\t\n\tbrowser = __webpack_require__(2);\n\t\n\tGIF = (function(superClass) {\n\t  var defaults, frameDefaults;\n\t\n\t  extend(GIF, superClass);\n\t\n\t  defaults = {\n\t    workerScript: 'gif.worker.js',\n\t    workers: 2,\n\t    repeat: 0,\n\t    background: '#fff',\n\t    quality: 10,\n\t    width: null,\n\t    height: null,\n\t    transparent: null,\n\t    debug: false\n\t  };\n\t\n\t  frameDefaults = {\n\t    delay: 500,\n\t    copy: false\n\t  };\n\t\n\t  function GIF(options) {\n\t    var base, key, value;\n\t    this.running = false;\n\t    this.options = {};\n\t    this.frames = [];\n\t    this.groups = new Map();\n\t    this.freeWorkers = [];\n\t    this.activeWorkers = [];\n\t    this.setOptions(options);\n\t    for (key in defaults) {\n\t      value = defaults[key];\n\t      if ((base = this.options)[key] == null) {\n\t        base[key] = value;\n\t      }\n\t    }\n\t  }\n\t\n\t  GIF.prototype.setOption = function(key, value) {\n\t    this.options[key] = value;\n\t    if ((this._canvas != null) && (key === 'width' || key === 'height')) {\n\t      return this._canvas[key] = value;\n\t    }\n\t  };\n\t\n\t  GIF.prototype.setOptions = function(options) {\n\t    var key, results, value;\n\t    results = [];\n\t    for (key in options) {\n\t      if (!hasProp.call(options, key)) continue;\n\t      value = options[key];\n\t      results.push(this.setOption(key, value));\n\t    }\n\t    return results;\n\t  };\n\t\n\t  GIF.prototype.addFrame = function(image, options) {\n\t    var frame, index, key;\n\t    if (options == null) {\n\t      options = {};\n\t    }\n\t    frame = {};\n\t    frame.transparent = this.options.transparent;\n\t    for (key in frameDefaults) {\n\t      frame[key] = options[key] || frameDefaults[key];\n\t    }\n\t    if (this.options.width == null) {\n\t      this.setOption('width', image.width);\n\t    }\n\t    if (this.options.height == null) {\n\t      this.setOption('height', image.height);\n\t    }\n\t    if ((typeof ImageData !== \"undefined\" && ImageData !== null) && image instanceof ImageData) {\n\t      frame.data = image.data;\n\t    } else if (((typeof CanvasRenderingContext2D !== \"undefined\" && CanvasRenderingContext2D !== null) && image instanceof CanvasRenderingContext2D) || ((typeof WebGLRenderingContext !== \"undefined\" && WebGLRenderingContext !== null) && image instanceof WebGLRenderingContext)) {\n\t      if (options.copy) {\n\t        frame.data = this.getContextData(image);\n\t      } else {\n\t        frame.context = image;\n\t      }\n\t    } else if (image.childNodes != null) {\n\t      if (options.copy) {\n\t        frame.data = this.getImageData(image);\n\t      } else {\n\t        frame.image = image;\n\t      }\n\t    } else {\n\t      throw new Error('Invalid image');\n\t    }\n\t    index = this.frames.length;\n\t    if (index > 0 && frame.data) {\n\t      if (this.groups.has(frame.data)) {\n\t        this.groups.get(frame.data).push(index);\n\t      } else {\n\t        this.groups.set(frame.data, [index]);\n\t      }\n\t    }\n\t    return this.frames.push(frame);\n\t  };\n\t\n\t  GIF.prototype.render = function() {\n\t    var i, j, numWorkers, ref;\n\t    if (this.running) {\n\t      throw new Error('Already running');\n\t    }\n\t    if ((this.options.width == null) || (this.options.height == null)) {\n\t      throw new Error('Width and height must be set prior to rendering');\n\t    }\n\t    this.running = true;\n\t    this.nextFrame = 0;\n\t    this.finishedFrames = 0;\n\t    this.imageParts = (function() {\n\t      var j, ref, results;\n\t      results = [];\n\t      for (i = j = 0, ref = this.frames.length; 0 <= ref ? j < ref : j > ref; i = 0 <= ref ? ++j : --j) {\n\t        results.push(null);\n\t      }\n\t      return results;\n\t    }).call(this);\n\t    numWorkers = this.spawnWorkers();\n\t    if (this.options.globalPalette === true) {\n\t      this.renderNextFrame();\n\t    } else {\n\t      for (i = j = 0, ref = numWorkers; 0 <= ref ? j < ref : j > ref; i = 0 <= ref ? ++j : --j) {\n\t        this.renderNextFrame();\n\t      }\n\t    }\n\t    this.emit('start');\n\t    return this.emit('progress', 0);\n\t  };\n\t\n\t  GIF.prototype.abort = function() {\n\t    var worker;\n\t    while (true) {\n\t      worker = this.activeWorkers.shift();\n\t      if (worker == null) {\n\t        break;\n\t      }\n\t      this.log(\"killing active worker\");\n\t      worker.terminate();\n\t    }\n\t    this.running = false;\n\t    return this.emit('abort');\n\t  };\n\t\n\t  GIF.prototype.spawnWorkers = function() {\n\t    var j, numWorkers, ref, results;\n\t    numWorkers = Math.min(this.options.workers, this.frames.length);\n\t    (function() {\n\t      results = [];\n\t      for (var j = ref = this.freeWorkers.length; ref <= numWorkers ? j < numWorkers : j > numWorkers; ref <= numWorkers ? j++ : j--){ results.push(j); }\n\t      return results;\n\t    }).apply(this).forEach((function(_this) {\n\t      return function(i) {\n\t        var worker;\n\t        _this.log(\"spawning worker \" + i);\n\t        worker = new Worker(_this.options.workerScript);\n\t        worker.onmessage = function(event) {\n\t          _this.activeWorkers.splice(_this.activeWorkers.indexOf(worker), 1);\n\t          _this.freeWorkers.push(worker);\n\t          return _this.frameFinished(event.data, false);\n\t        };\n\t        return _this.freeWorkers.push(worker);\n\t      };\n\t    })(this));\n\t    return numWorkers;\n\t  };\n\t\n\t  GIF.prototype.frameFinished = function(frame, duplicate) {\n\t    var i, indexOfDuplicate, indexOfFirstInGroup, j, ref;\n\t    this.finishedFrames++;\n\t    if (!duplicate) {\n\t      this.log(\"frame \" + (frame.index + 1) + \" finished - \" + this.activeWorkers.length + \" active\");\n\t      this.emit('progress', this.finishedFrames / this.frames.length);\n\t      this.imageParts[frame.index] = frame;\n\t    } else {\n\t      indexOfDuplicate = this.frames.indexOf(frame);\n\t      indexOfFirstInGroup = this.groups.get(frame.data)[0];\n\t      this.log(\"frame \" + (indexOfDuplicate + 1) + \" is duplicate of \" + indexOfFirstInGroup + \" - \" + this.activeWorkers.length + \" active\");\n\t      this.imageParts[indexOfDuplicate] = {\n\t        indexOfFirstInGroup: indexOfFirstInGroup\n\t      };\n\t    }\n\t    if (this.options.globalPalette === true && !duplicate) {\n\t      this.options.globalPalette = frame.globalPalette;\n\t      this.log(\"global palette analyzed\");\n\t      if (this.frames.length > 2) {\n\t        for (i = j = 1, ref = this.freeWorkers.length; 1 <= ref ? j < ref : j > ref; i = 1 <= ref ? ++j : --j) {\n\t          this.renderNextFrame();\n\t        }\n\t      }\n\t    }\n\t    if (indexOf.call(this.imageParts, null) >= 0) {\n\t      return this.renderNextFrame();\n\t    } else {\n\t      return this.finishRendering();\n\t    }\n\t  };\n\t\n\t  GIF.prototype.finishRendering = function() {\n\t    var data, frame, i, image, index, j, k, l, len, len1, len2, len3, len4, m, offset, page, ref, ref1, ref2, ref3;\n\t    ref = this.imageParts;\n\t    for (index = j = 0, len1 = ref.length; j < len1; index = ++j) {\n\t      frame = ref[index];\n\t      if (frame.indexOfFirstInGroup) {\n\t        this.imageParts[index] = this.imageParts[frame.indexOfFirstInGroup];\n\t      }\n\t    }\n\t    len = 0;\n\t    ref1 = this.imageParts;\n\t    for (k = 0, len2 = ref1.length; k < len2; k++) {\n\t      frame = ref1[k];\n\t      len += (frame.data.length - 1) * frame.pageSize + frame.cursor;\n\t    }\n\t    len += frame.pageSize - frame.cursor;\n\t    this.log(\"rendering finished - filesize \" + (Math.round(len / 1000)) + \"kb\");\n\t    data = new Uint8Array(len);\n\t    offset = 0;\n\t    ref2 = this.imageParts;\n\t    for (l = 0, len3 = ref2.length; l < len3; l++) {\n\t      frame = ref2[l];\n\t      ref3 = frame.data;\n\t      for (i = m = 0, len4 = ref3.length; m < len4; i = ++m) {\n\t        page = ref3[i];\n\t        data.set(page, offset);\n\t        if (i === frame.data.length - 1) {\n\t          offset += frame.cursor;\n\t        } else {\n\t          offset += frame.pageSize;\n\t        }\n\t      }\n\t    }\n\t    image = new Blob([data], {\n\t      type: 'image/gif'\n\t    });\n\t    return this.emit('finished', image, data);\n\t  };\n\t\n\t  GIF.prototype.renderNextFrame = function() {\n\t    var frame, index, task, worker;\n\t    if (this.freeWorkers.length === 0) {\n\t      throw new Error('No free workers');\n\t    }\n\t    if (this.nextFrame >= this.frames.length) {\n\t      return;\n\t    }\n\t    frame = this.frames[this.nextFrame++];\n\t    index = this.frames.indexOf(frame);\n\t    if (index > 0 && this.groups.has(frame.data) && this.groups.get(frame.data)[0] !== index) {\n\t      setTimeout((function(_this) {\n\t        return function() {\n\t          return _this.frameFinished(frame, true);\n\t        };\n\t      })(this), 0);\n\t      return;\n\t    }\n\t    worker = this.freeWorkers.shift();\n\t    task = this.getTask(frame);\n\t    this.log(\"starting frame \" + (task.index + 1) + \" of \" + this.frames.length);\n\t    this.activeWorkers.push(worker);\n\t    return worker.postMessage(task);\n\t  };\n\t\n\t  GIF.prototype.getContextData = function(ctx) {\n\t    return ctx.getImageData(0, 0, this.options.width, this.options.height).data;\n\t  };\n\t\n\t  GIF.prototype.getImageData = function(image) {\n\t    var ctx;\n\t    if (this._canvas == null) {\n\t      this._canvas = document.createElement('canvas');\n\t      this._canvas.width = this.options.width;\n\t      this._canvas.height = this.options.height;\n\t    }\n\t    ctx = this._canvas.getContext('2d');\n\t    ctx.setFill = this.options.background;\n\t    ctx.fillRect(0, 0, this.options.width, this.options.height);\n\t    ctx.drawImage(image, 0, 0);\n\t    return this.getContextData(ctx);\n\t  };\n\t\n\t  GIF.prototype.getTask = function(frame) {\n\t    var index, task;\n\t    index = this.frames.indexOf(frame);\n\t    task = {\n\t      index: index,\n\t      last: index === (this.frames.length - 1),\n\t      delay: frame.delay,\n\t      transparent: frame.transparent,\n\t      width: this.options.width,\n\t      height: this.options.height,\n\t      quality: this.options.quality,\n\t      dither: this.options.dither,\n\t      globalPalette: this.options.globalPalette,\n\t      repeat: this.options.repeat,\n\t      canTransfer: true\n\t    };\n\t    if (frame.data != null) {\n\t      task.data = frame.data;\n\t    } else if (frame.context != null) {\n\t      task.data = this.getContextData(frame.context);\n\t    } else if (frame.image != null) {\n\t      task.data = this.getImageData(frame.image);\n\t    } else {\n\t      throw new Error('Invalid frame');\n\t    }\n\t    return task;\n\t  };\n\t\n\t  GIF.prototype.log = function(msg) {\n\t    if (this.options.debug) {\n\t      return console.log(msg);\n\t    }\n\t  };\n\t\n\t  return GIF;\n\t\n\t})(EventEmitter);\n\t\n\tmodule.exports = GIF;\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\t// Copyright Joyent, Inc. and other Node contributors.\n\t//\n\t// Permission is hereby granted, free of charge, to any person obtaining a\n\t// copy of this software and associated documentation files (the\n\t// \"Software\"), to deal in the Software without restriction, including\n\t// without limitation the rights to use, copy, modify, merge, publish,\n\t// distribute, sublicense, and/or sell copies of the Software, and to permit\n\t// persons to whom the Software is furnished to do so, subject to the\n\t// following conditions:\n\t//\n\t// The above copyright notice and this permission notice shall be included\n\t// in all copies or substantial portions of the Software.\n\t//\n\t// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n\t// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n\t// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n\t// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n\t// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n\t// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n\t// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\t\n\tfunction EventEmitter() {\n\t  this._events = this._events || {};\n\t  this._maxListeners = this._maxListeners || undefined;\n\t}\n\tmodule.exports = EventEmitter;\n\t\n\t// Backwards-compat with node 0.10.x\n\tEventEmitter.EventEmitter = EventEmitter;\n\t\n\tEventEmitter.prototype._events = undefined;\n\tEventEmitter.prototype._maxListeners = undefined;\n\t\n\t// By default EventEmitters will print a warning if more than 10 listeners are\n\t// added to it. This is a useful default which helps finding memory leaks.\n\tEventEmitter.defaultMaxListeners = 10;\n\t\n\t// Obviously not all Emitters should be limited to 10. This function allows\n\t// that to be increased. Set to zero for unlimited.\n\tEventEmitter.prototype.setMaxListeners = function(n) {\n\t  if (!isNumber(n) || n < 0 || isNaN(n))\n\t    throw TypeError('n must be a positive number');\n\t  this._maxListeners = n;\n\t  return this;\n\t};\n\t\n\tEventEmitter.prototype.emit = function(type) {\n\t  var er, handler, len, args, i, listeners;\n\t\n\t  if (!this._events)\n\t    this._events = {};\n\t\n\t  // If there is no 'error' event listener then throw.\n\t  if (type === 'error') {\n\t    if (!this._events.error ||\n\t        (isObject(this._events.error) && !this._events.error.length)) {\n\t      er = arguments[1];\n\t      if (er instanceof Error) {\n\t        throw er; // Unhandled 'error' event\n\t      } else {\n\t        // At least give some kind of context to the user\n\t        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n\t        err.context = er;\n\t        throw err;\n\t      }\n\t    }\n\t  }\n\t\n\t  handler = this._events[type];\n\t\n\t  if (isUndefined(handler))\n\t    return false;\n\t\n\t  if (isFunction(handler)) {\n\t    switch (arguments.length) {\n\t      // fast cases\n\t      case 1:\n\t        handler.call(this);\n\t        break;\n\t      case 2:\n\t        handler.call(this, arguments[1]);\n\t        break;\n\t      case 3:\n\t        handler.call(this, arguments[1], arguments[2]);\n\t        break;\n\t      // slower\n\t      default:\n\t        args = Array.prototype.slice.call(arguments, 1);\n\t        handler.apply(this, args);\n\t    }\n\t  } else if (isObject(handler)) {\n\t    args = Array.prototype.slice.call(arguments, 1);\n\t    listeners = handler.slice();\n\t    len = listeners.length;\n\t    for (i = 0; i < len; i++)\n\t      listeners[i].apply(this, args);\n\t  }\n\t\n\t  return true;\n\t};\n\t\n\tEventEmitter.prototype.addListener = function(type, listener) {\n\t  var m;\n\t\n\t  if (!isFunction(listener))\n\t    throw TypeError('listener must be a function');\n\t\n\t  if (!this._events)\n\t    this._events = {};\n\t\n\t  // To avoid recursion in the case that type === \"newListener\"! Before\n\t  // adding it to the listeners, first emit \"newListener\".\n\t  if (this._events.newListener)\n\t    this.emit('newListener', type,\n\t              isFunction(listener.listener) ?\n\t              listener.listener : listener);\n\t\n\t  if (!this._events[type])\n\t    // Optimize the case of one listener. Don't need the extra array object.\n\t    this._events[type] = listener;\n\t  else if (isObject(this._events[type]))\n\t    // If we've already got an array, just append.\n\t    this._events[type].push(listener);\n\t  else\n\t    // Adding the second element, need to change to array.\n\t    this._events[type] = [this._events[type], listener];\n\t\n\t  // Check for listener leak\n\t  if (isObject(this._events[type]) && !this._events[type].warned) {\n\t    if (!isUndefined(this._maxListeners)) {\n\t      m = this._maxListeners;\n\t    } else {\n\t      m = EventEmitter.defaultMaxListeners;\n\t    }\n\t\n\t    if (m && m > 0 && this._events[type].length > m) {\n\t      this._events[type].warned = true;\n\t      console.error('(node) warning: possible EventEmitter memory ' +\n\t                    'leak detected. %d listeners added. ' +\n\t                    'Use emitter.setMaxListeners() to increase limit.',\n\t                    this._events[type].length);\n\t      if (typeof console.trace === 'function') {\n\t        // not supported in IE 10\n\t        console.trace();\n\t      }\n\t    }\n\t  }\n\t\n\t  return this;\n\t};\n\t\n\tEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\t\n\tEventEmitter.prototype.once = function(type, listener) {\n\t  if (!isFunction(listener))\n\t    throw TypeError('listener must be a function');\n\t\n\t  var fired = false;\n\t\n\t  function g() {\n\t    this.removeListener(type, g);\n\t\n\t    if (!fired) {\n\t      fired = true;\n\t      listener.apply(this, arguments);\n\t    }\n\t  }\n\t\n\t  g.listener = listener;\n\t  this.on(type, g);\n\t\n\t  return this;\n\t};\n\t\n\t// emits a 'removeListener' event iff the listener was removed\n\tEventEmitter.prototype.removeListener = function(type, listener) {\n\t  var list, position, length, i;\n\t\n\t  if (!isFunction(listener))\n\t    throw TypeError('listener must be a function');\n\t\n\t  if (!this._events || !this._events[type])\n\t    return this;\n\t\n\t  list = this._events[type];\n\t  length = list.length;\n\t  position = -1;\n\t\n\t  if (list === listener ||\n\t      (isFunction(list.listener) && list.listener === listener)) {\n\t    delete this._events[type];\n\t    if (this._events.removeListener)\n\t      this.emit('removeListener', type, listener);\n\t\n\t  } else if (isObject(list)) {\n\t    for (i = length; i-- > 0;) {\n\t      if (list[i] === listener ||\n\t          (list[i].listener && list[i].listener === listener)) {\n\t        position = i;\n\t        break;\n\t      }\n\t    }\n\t\n\t    if (position < 0)\n\t      return this;\n\t\n\t    if (list.length === 1) {\n\t      list.length = 0;\n\t      delete this._events[type];\n\t    } else {\n\t      list.splice(position, 1);\n\t    }\n\t\n\t    if (this._events.removeListener)\n\t      this.emit('removeListener', type, listener);\n\t  }\n\t\n\t  return this;\n\t};\n\t\n\tEventEmitter.prototype.removeAllListeners = function(type) {\n\t  var key, listeners;\n\t\n\t  if (!this._events)\n\t    return this;\n\t\n\t  // not listening for removeListener, no need to emit\n\t  if (!this._events.removeListener) {\n\t    if (arguments.length === 0)\n\t      this._events = {};\n\t    else if (this._events[type])\n\t      delete this._events[type];\n\t    return this;\n\t  }\n\t\n\t  // emit removeListener for all listeners on all events\n\t  if (arguments.length === 0) {\n\t    for (key in this._events) {\n\t      if (key === 'removeListener') continue;\n\t      this.removeAllListeners(key);\n\t    }\n\t    this.removeAllListeners('removeListener');\n\t    this._events = {};\n\t    return this;\n\t  }\n\t\n\t  listeners = this._events[type];\n\t\n\t  if (isFunction(listeners)) {\n\t    this.removeListener(type, listeners);\n\t  } else if (listeners) {\n\t    // LIFO order\n\t    while (listeners.length)\n\t      this.removeListener(type, listeners[listeners.length - 1]);\n\t  }\n\t  delete this._events[type];\n\t\n\t  return this;\n\t};\n\t\n\tEventEmitter.prototype.listeners = function(type) {\n\t  var ret;\n\t  if (!this._events || !this._events[type])\n\t    ret = [];\n\t  else if (isFunction(this._events[type]))\n\t    ret = [this._events[type]];\n\t  else\n\t    ret = this._events[type].slice();\n\t  return ret;\n\t};\n\t\n\tEventEmitter.prototype.listenerCount = function(type) {\n\t  if (this._events) {\n\t    var evlistener = this._events[type];\n\t\n\t    if (isFunction(evlistener))\n\t      return 1;\n\t    else if (evlistener)\n\t      return evlistener.length;\n\t  }\n\t  return 0;\n\t};\n\t\n\tEventEmitter.listenerCount = function(emitter, type) {\n\t  return emitter.listenerCount(type);\n\t};\n\t\n\tfunction isFunction(arg) {\n\t  return typeof arg === 'function';\n\t}\n\t\n\tfunction isNumber(arg) {\n\t  return typeof arg === 'number';\n\t}\n\t\n\tfunction isObject(arg) {\n\t  return typeof arg === 'object' && arg !== null;\n\t}\n\t\n\tfunction isUndefined(arg) {\n\t  return arg === void 0;\n\t}\n\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\t\n\t/* CoffeeScript version of the browser detection from MooTools */\n\tvar UA, browser, mode, platform, ua;\n\t\n\tua = navigator.userAgent.toLowerCase();\n\t\n\tplatform = navigator.platform.toLowerCase();\n\t\n\tUA = ua.match(/(opera|ie|firefox|chrome|version)[\\s\\/:]([\\w\\d\\.]+)?.*?(safari|version[\\s\\/:]([\\w\\d\\.]+)|$)/) || [null, 'unknown', 0];\n\t\n\tmode = UA[1] === 'ie' && document.documentMode;\n\t\n\tbrowser = {\n\t  name: UA[1] === 'version' ? UA[3] : UA[1],\n\t  version: mode || parseFloat(UA[1] === 'opera' && UA[4] ? UA[4] : UA[2]),\n\t  platform: {\n\t    name: ua.match(/ip(?:ad|od|hone)/) ? 'ios' : (ua.match(/(?:webos|android)/) || platform.match(/mac|win|linux/) || ['other'])[0]\n\t  }\n\t};\n\t\n\tbrowser[browser.name] = true;\n\t\n\tbrowser[browser.name + parseInt(browser.version, 10)] = true;\n\t\n\tbrowser.platform[browser.platform.name] = true;\n\t\n\tmodule.exports = browser;\n\n\n/***/ }\n/******/ ])\n});\n;\n\n\n/** WEBPACK FOOTER **\n ** gif.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap c4508600e32c0e7f0139\n **/","{EventEmitter} = require 'events'\r\nbrowser = require './browser.coffee'\r\n\r\nclass GIF extends EventEmitter\r\n\r\n  defaults =\r\n    workerScript: 'gif.worker.js'\r\n    workers: 2\r\n    repeat: 0 # repeat forever, -1 = repeat once\r\n    background: '#fff'\r\n    quality: 10 # pixel sample interval, lower is better\r\n    width: null # size derermined from first frame if possible\r\n    height: null\r\n    transparent: null\r\n    debug: false\r\n\r\n  frameDefaults =\r\n    delay: 500 # ms\r\n    copy: false\r\n\r\n  constructor: (options) ->\r\n    @running = false\r\n\r\n    @options = {}\r\n    @frames = []\r\n\r\n    # TODO: compare by instance and not by data\r\n    @groups = new Map() # for [data1, data1, data2, data1] @groups[data1] == [1, 3] and @groups[data2] = [2]\r\n\r\n    @freeWorkers = []\r\n    @activeWorkers = []\r\n\r\n    @setOptions options\r\n    for key, value of defaults\r\n      @options[key] ?= value\r\n\r\n  setOption: (key, value) ->\r\n    @options[key] = value\r\n    if @_canvas? and key in ['width', 'height']\r\n      @_canvas[key] = value\r\n\r\n  setOptions: (options) ->\r\n    @setOption key, value for own key, value of options\r\n\r\n  addFrame: (image, options={}) ->\r\n    frame = {}\r\n    frame.transparent = @options.transparent\r\n    for key of frameDefaults\r\n      frame[key] = options[key] or frameDefaults[key]\r\n\r\n    # use the images width and height for options unless already set\r\n    @setOption 'width', image.width unless @options.width?\r\n    @setOption 'height', image.height unless @options.height?\r\n\r\n    if ImageData? and image instanceof ImageData\r\n       frame.data = image.data\r\n    else if (CanvasRenderingContext2D? and image instanceof CanvasRenderingContext2D) or (WebGLRenderingContext? and image instanceof WebGLRenderingContext)\r\n      if options.copy\r\n        frame.data = @getContextData image\r\n      else\r\n        frame.context = image\r\n    else if image.childNodes?\r\n      if options.copy\r\n        frame.data = @getImageData image\r\n      else\r\n        frame.image = image\r\n    else\r\n      throw new Error 'Invalid image'\r\n\r\n    # find duplicates in frames.data\r\n    index = @frames.length\r\n    if index > 0 and frame.data # frame 0 contains header, do not count it\r\n      if @groups.has(frame.data)\r\n        @groups.get(frame.data).push index\r\n      else\r\n        @groups.set frame.data, [index]\r\n\r\n    @frames.push frame\r\n\r\n  render: ->\r\n    throw new Error 'Already running' if @running\r\n\r\n    if not @options.width? or not @options.height?\r\n      throw new Error 'Width and height must be set prior to rendering'\r\n\r\n    @running = true\r\n    @nextFrame = 0\r\n    @finishedFrames = 0\r\n\r\n    @imageParts = (null for i in [0...@frames.length])\r\n    numWorkers = @spawnWorkers()\r\n    # we need to wait for the palette\r\n    if @options.globalPalette == true\r\n      @renderNextFrame()\r\n    else\r\n      @renderNextFrame() for i in [0...numWorkers]\r\n\r\n    @emit 'start'\r\n    @emit 'progress', 0\r\n\r\n  abort: ->\r\n    loop\r\n      worker = @activeWorkers.shift()\r\n      break unless worker?\r\n      @log \"killing active worker\"\r\n      worker.terminate()\r\n    @running = false\r\n    @emit 'abort'\r\n\r\n  # private\r\n\r\n  spawnWorkers: ->\r\n    numWorkers = Math.min(@options.workers, @frames.length)\r\n    [@freeWorkers.length...numWorkers].forEach (i) =>\r\n      @log \"spawning worker #{ i }\"\r\n      worker = new Worker @options.workerScript\r\n      worker.onmessage = (event) =>\r\n        @activeWorkers.splice @activeWorkers.indexOf(worker), 1\r\n        @freeWorkers.push worker\r\n        @frameFinished event.data, false\r\n      @freeWorkers.push worker\r\n    return numWorkers\r\n\r\n  frameFinished: (frame, duplicate) ->\r\n    @finishedFrames++\r\n    if not duplicate\r\n      @log \"frame #{ frame.index + 1 } finished - #{ @activeWorkers.length } active\"\r\n      @emit 'progress', @finishedFrames / @frames.length\r\n      @imageParts[frame.index] = frame\r\n    else\r\n      indexOfDuplicate = @frames.indexOf frame\r\n      indexOfFirstInGroup = @groups.get(frame.data)[0]\r\n      @log \"frame #{ indexOfDuplicate + 1 } is duplicate of #{ indexOfFirstInGroup } - #{ @activeWorkers.length } active\"\r\n      @imageParts[indexOfDuplicate] = { indexOfFirstInGroup: indexOfFirstInGroup } # do not put frame here, as it may not be available still. Put index.\r\n    # remember calculated palette, spawn the rest of the workers\r\n    if @options.globalPalette == true and not duplicate\r\n      @options.globalPalette = frame.globalPalette\r\n      @log \"global palette analyzed\"\r\n      @renderNextFrame() for i in [1...@freeWorkers.length] if @frames.length > 2\r\n    if null in @imageParts\r\n      @renderNextFrame()\r\n    else\r\n      @finishRendering()\r\n\r\n  finishRendering: ->\r\n    for frame, index in @imageParts\r\n      @imageParts[index] = @imageParts[frame.indexOfFirstInGroup] if frame.indexOfFirstInGroup\r\n    len = 0\r\n    for frame in @imageParts\r\n      len += (frame.data.length - 1) * frame.pageSize + frame.cursor\r\n    len += frame.pageSize - frame.cursor\r\n    @log \"rendering finished - filesize #{ Math.round(len / 1000) }kb\"\r\n    data = new Uint8Array len\r\n    offset = 0\r\n    for frame in @imageParts\r\n      for page, i in frame.data\r\n        data.set page, offset\r\n        if i is frame.data.length - 1\r\n          offset += frame.cursor\r\n        else\r\n          offset += frame.pageSize\r\n\r\n    image = new Blob [data],\r\n      type: 'image/gif'\r\n\r\n    @emit 'finished', image, data\r\n\r\n  renderNextFrame: ->\r\n    throw new Error 'No free workers' if @freeWorkers.length is 0\r\n    return if @nextFrame >= @frames.length # no new frame to render\r\n\r\n    frame = @frames[@nextFrame++]\r\n\r\n    # check if one of duplicates, but not the first in group\r\n    index = @frames.indexOf frame\r\n    if index > 0 and @groups.has(frame.data) and @groups.get(frame.data)[0] != index\r\n      setTimeout =>\r\n        @frameFinished frame, true\r\n      , 0\r\n      return\r\n\r\n    worker = @freeWorkers.shift()\r\n    task = @getTask frame\r\n\r\n    @log \"starting frame #{ task.index + 1 } of #{ @frames.length }\"\r\n    @activeWorkers.push worker\r\n    worker.postMessage task#, [task.data.buffer]\r\n\r\n  getContextData: (ctx) ->\r\n    return ctx.getImageData(0, 0, @options.width, @options.height).data\r\n\r\n  getImageData: (image) ->\r\n    if not @_canvas?\r\n      @_canvas = document.createElement 'canvas'\r\n      @_canvas.width = @options.width\r\n      @_canvas.height = @options.height\r\n\r\n    ctx = @_canvas.getContext '2d'\r\n    ctx.setFill = @options.background\r\n    ctx.fillRect 0, 0, @options.width, @options.height\r\n    ctx.drawImage image, 0, 0\r\n\r\n    return @getContextData ctx\r\n\r\n  getTask: (frame) ->\r\n    index = @frames.indexOf frame\r\n    task =\r\n      index: index\r\n      last: index is (@frames.length - 1)\r\n      delay: frame.delay\r\n      transparent: frame.transparent\r\n      width: @options.width\r\n      height: @options.height\r\n      quality: @options.quality\r\n      dither: @options.dither\r\n      globalPalette: @options.globalPalette\r\n      repeat: @options.repeat\r\n      canTransfer: true\r\n\r\n    if frame.data?\r\n      task.data = frame.data\r\n    else if frame.context?\r\n      task.data = @getContextData frame.context\r\n    else if frame.image?\r\n      task.data = @getImageData frame.image\r\n    else\r\n      throw new Error 'Invalid frame'\r\n\r\n    return task\r\n\r\n  log: (msg) ->\r\n    console.log msg if @options.debug\r\n\r\nmodule.exports = GIF\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/gif.coffee\n **/","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/events/events.js\n ** module id = 1\n ** module chunks = 0\n **/","const scale = 3;\nconst count = 16;\nconst size = 16 * scale;\nconst spacing = 1 * scale;\nconst padding = size * 4;\nconst width = count * (size + spacing) + 2 * padding;\n\nimport GIF from \"gif.js.optimized\";\n\nconst workerScript = document.getElementById('worker').src;\n\nconst $output = document.getElementById('output');\nconst $editor = document.getElementById('editor');\nconst $input = document.getElementById('input');\nconst $duration = document.getElementById('duration');\n\nconst context = $output.getContext('2d');\n\nconst url = new URL(document.location);\n\nif (url.searchParams.has('code')) {\n  $input.value = url.searchParams.get('code');\n}\n\nif (url.searchParams.has('duration')) {\n  $duration.value = url.searchParams.get('duration');\n}\n\nfunction run(){\n\n  var gif = new GIF({\n    workerScript,\n    workers: 4,\n    quality: 100,\n    background: '#000000',\n    width: width,\n    height: width\n  });\n\n  const code = $input.value;\n  const duration = $duration.value;\n\n  url.searchParams.set('code', code);\n  url.searchParams.set('duration', duration);\n  history.replaceState(null, code, url);\n\n  const callback = new Function('t', 'i', 'x', 'y', `\n    try {\n      with (Math) {\n        return ${code};\n      }\n    } catch (error) {\n      return error;\n    }\n  `);\n\n  let time = 0;\n\n  $output.width = $output.height = width;\n\n  function render() {\n\n    context.fillStyle = '#000';\n    context.fillRect(0, 0, width, width);\n\n    let index = 0;\n    for (let y = 0; y < count; y++) {\n      for (let x = 0; x < count; x++) {\n        const value = Number(callback(time, index, x, y));\n        const offset = size / 2;\n        let color = '#FFF';\n        let radius = (value * size) / 2;\n\n        if (radius < 0) {\n          radius = -radius;\n          color = '#F24';\n        }\n\n        if (radius > size / 2) {\n          radius = size / 2;\n        }\n\n        context.beginPath();\n        context.fillStyle = color;\n        context.arc(\n          x * (size + spacing) + offset + padding,\n          y * (size + spacing) + offset + padding,\n          radius,\n          0,\n          2 * Math.PI\n        );\n        context.fill();\n        index++;\n      }\n    }\n    gif.addFrame(context, {copy: true, delay: 20});\n  }\n\n  while (time < duration) {\n    render();\n    time += 1 / 50;\n  }\n\n  const t = new Date();\n\n  gif.on('finished', function(blob) {\n\n    const link = document.createElement(\"a\");\n    link.download='tixy.gif';\n    link.href=URL.createObjectURL(blob);\n    link.click();\n\n    document.location = URL.createObjectURL(blob);\n  });\n\n  gif.on('abort', function() {\n    console.log('abort', arguments)\n  });\n\n  gif.on('progress', function(ratio) {\n    $editor.innerText = `exporting ${Math.round(ratio * 100)}%`;\n  });\n\n  gif.render();\n}\n\n$editor.addEventListener('submit', (event) => {\n  event.preventDefault();\n  $editor.innerText = 'rendering ...'\n  setTimeout(run, 300);\n})"]}